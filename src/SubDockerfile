FROM ubuntu:16.04 as ubuntu

# Add the code directory, to the root.
ADD ./* /project/

# Update and install the necessary dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    software-properties-common

# Install the solidity compiler. http://solidity.readthedocs.io/en/develop/installing-solidity.html#binary-packages
RUN add-apt-repository ppa:ethereum/ethereum && apt-get update && apt-get install -y solc

# Install NodeJS
RUN apt-get update && apt-get install -y apt-transport-https curl
RUN sh -c 'curl -sL https://deb.nodesource.com/setup_9.x | bash -'
RUN apt-get install -y nodejs

# Install truffle framework for building and deploying contracts
RUN npm install -g truffle

RUN npm install -g web3

# Change the working directory, to the one, where project lies.
WORKDIR /project/src/

# Delegate all other work to `bash`.
RUN chmod +x run.sh
CMD ["bash", "run.sh"]
